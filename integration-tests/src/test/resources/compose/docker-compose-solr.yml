version: '2.1'

services:
  alfresco:
    environment:
      - INDEX=solr6

  solr:
    image: docker.io/xenit/alfresco-solr6:1.4
    container_name: solr
    volumes:
      - solr:/opt/alfresco/alf_data
    entrypoint: /bin/bash -c "while !(curl --silent -t1 -f 'http://alfresco:8080/alfresco/s/api/server' ) ; do echo ..; sleep 5; done; echo alfresco is up; /docker-entrypoint.sh $${SOLR_INSTALL_HOME}/startup.sh"
    environment:
      - ALFRESCO_HOST=alfresco
      - JAVA_XMS=512M
      - JAVA_XMX=2048M
      - SHARDING=false

volumes:
  solr: